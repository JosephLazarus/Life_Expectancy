---
title: 'Objective 2: Experimental Models'
author: "Joseph Lazarus"
date: "5/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r life expectancy data}
#data is cleaned and scaled (Friday May 28th)
df <- read.csv("https://raw.githubusercontent.com/JosephLazarus/Life_Expectancy/main/Data_Folder/clean_scaled.csv", header = TRUE, fileEncoding="UTF-8-BOM")
```

Here i am checking my models.

IMPORTANT:  I have not done a split on date. Date is not present in this cleaned_scaled.csv


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
                              Train/Test Split code
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

```{r}

set.seed(31) # prime number for good luck

sample_size = round(nrow(df)*.70) # setting what is 70%
index <- sample(seq_len(nrow(df)), size = sample_size)

training.data <- df[index, ]
testing.data <- df[-index, ]

#sanity check the split
dim(df)
dim(training.data)
dim(testing.data)


```

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                             Step 3.1: Experimental Model Engine
                                       Knn Regression
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
```{r}
options("install.lock"=FALSE)
library(caret)
#step 1 standardize the data. This data set is pre-scaled

#K Nearest Neighbors Regression using Caret

knnt1 <- knnreg(training.data$Life.expectancy ~ ., data = training.data, k=1)
knnt2 <- knnreg(training.data$Life.expectancy ~ ., data = training.data, k=2)

#measure of model performance
knnt1.mse <- mean((training.data$Life.expectancy - predict(knnt1,training.data$Adult.Mortality))^2)
knnt2.mse <- mean((training.data$Life.expectancy - predict(knnt2, data =training.data))^2)

knnt1.mae <- caret::MAE(testing.data$y, knnt1)
knnt2.mae <- caret::MAE(testing.data$y, knnt1)

knn1.rsme <- caret::RSME(testing.data$y, knnt1)
knn1.rsme <- caret::RSME(testing.data$y, knnt1)

#Tuning the Hyperparameter K
k.to.try = seq(1,51, by = 2)

train.knn <- function(mr.rogers) {
  knnreg(training.data$Life.expectancy ~ ., data = training.data, k = mr.rogers)
}

knn.list <- lapply(k.to.try, train.knn)

calc.rmse = function(actual, predicted) {
  sqrt(mean((actual - predicted)^2))
}

knn.train.predictions <- lapply(knn.list, predict, training.data)
knn.test.predictions <- lapply(knn.list, predict, testing.data)


knn.rmse.train <- sapply(knn.train.predictions, calc.rmse, actual = training.data$Life.expectancy)
knn.rmse.test <- sapply(knn.test.predictions, calc.rmse, actual = testing.data$Life.expectancy)

k.to.try[which.min(knn.rmse.test)]

plot(k.to.try, knn.rmse.test, type = "b", col = "dodgerblue", pch = 20, 
     ylim = range(c(knn.rmse.test, knn.rmse.train)), 
    xlab = "K Neighbors",
    ylab = "RMSE Specificy units (years?",
    main = "Test and Training set RMSE vs K")
lines(k.to.try, knn.rmse.train, type = "b", col = "darkorange", pch = 23)
legend("bottomright", c("Train RMSE", "Test RMSE"), 
       col = c("darkorange", "dodgerblue"),
       lty = c(1), 
       pch = c(23, 20))

#find another knn regression model outside of caret

```